# Client Sight - Система управления базой клиентов

Backend часть системы управления базой клиентов и контактов с формированием модуля аналитики и генерации отчетов.

## Функциональные возможности

- Управление турами и заявками
- Ведение базы контактов и клиентов
- Управление пользовательскими ролями (Турист, Сотрудник, Управляющий)
- Аналитика и генерация отчетов

## Технический стек

- Node.js + Express
- TypeScript
- PostgreSQL
- Sequelize ORM
- JWT для аутентификации

## Требования для запуска

- Node.js 14+
- PostgreSQL 12+

## Установка и настройка

1. Клонировать репозиторий

```bash
git clone [repo-url]
cd client_sight-be
```

2. Установить зависимости

```bash
npm install
```

3. Настроить переменные окружения

```bash
cp .env.example .env
# Отредактировать файл .env в соответствии с вашей конфигурацией
```

4. Создать базу данных в PostgreSQL

```bash
createdb client_sight
# или используйте pgAdmin/другие инструменты
```

5. Инициализировать базу данных с тестовыми данными

```bash
npm run init-db
```

## Запуск приложения

### Режим разработки

```bash
npm run dev
```

### Режим production

```bash
npm run build
npm start
```

## Структура проекта

```
src/
├── config/       # Конфигурационные файлы
├── controllers/  # Контроллеры для обработки запросов
├── middleware/   # Промежуточные обработчики (авторизация и т.д.)
├── models/       # Модели данных Sequelize
├── routes/       # Определения маршрутов API
├── services/     # Бизнес-логика
├── utils/        # Вспомогательные функции
└── index.ts      # Точка входа приложения
```

## API Endpoints

### Аутентификация

- `POST /api/auth/register` - Регистрация пользователя (только для туристов)
- `POST /api/auth/login` - Авторизация пользователя
- `GET /api/auth/check` - Проверка токена и получение данных пользователя

### Пользователи

- `GET /api/users` - Получение списка пользователей (только для управляющих)
- `POST /api/users` - Создание пользователя-сотрудника (только для управляющих)
- `GET /api/users/:id` - Получение данных пользователя
- `PUT /api/users/:id` - Обновление данных пользователя
- `DELETE /api/users/:id` - Удаление пользователя

### Туры

- `GET /api/tours` - Получение списка туров
- `POST /api/tours` - Создание нового тура (только для сотрудников и управляющих)
- `GET /api/tours/:id` - Получение данных тура
- `PUT /api/tours/:id` - Обновление данных тура (только для сотрудников и управляющих)
- `DELETE /api/tours/:id` - Удаление тура (только для сотрудников и управляющих)

### Заявки

- `GET /api/applications` - Получение списка заявок (только для сотрудников и управляющих)
- `POST /api/applications` - Создание новой заявки
- `GET /api/applications/:id` - Получение данных заявки
- `PUT /api/applications/:id` - Обновление статуса заявки (только для сотрудников и управляющих)
- `DELETE /api/applications/:id` - Удаление заявки (только для управляющих)

### Контакты

- `GET /api/contacts` - Получение списка контактов (только для сотрудников и управляющих)
- `POST /api/contacts` - Создание нового контакта (только для сотрудников и управляющих)
- `GET /api/contacts/:id` - Получение данных контакта
- `PUT /api/contacts/:id` - Обновление данных контакта (только для сотрудников и управляющих)
- `DELETE /api/contacts/:id` - Удаление контакта (только для управляющих)

### Клиенты

- `GET /api/clients` - Получение списка клиентов (только для сотрудников и управляющих)
- `POST /api/clients/:contactId/tours/:tourId` - Добавление тура клиенту (только для сотрудников и управляющих)
- `DELETE /api/clients/:contactId/tours/:tourId` - Удаление тура у клиента (только для сотрудников и управляющих)

### Аналитика (только для управляющих)

- `GET /api/analytics/analysis` - Получение данных для анализа
- `GET /api/analytics/predictive` - Получение данных для предсказательной аналитики
- `GET /api/analytics/report` - Формирование полного отчета

## Тестовые пользователи

После инициализации базы данных, доступны следующие пользователи:

- Управляющий:

  - Email: manager@example.com
  - Пароль: admin123

- Сотрудник:

  - Email: employee@example.com
  - Пароль: employee123

- Турист:
  - Email: tourist@example.com
  - Пароль: tourist123
